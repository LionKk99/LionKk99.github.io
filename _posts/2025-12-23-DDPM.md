---
layout: post
title: "DDPM"
date: 2025-12-23 10:00:00 +0800
categories: ['ImgAgent', 'How do AI images and videos actually work (3Blue1Brown)', 'DDPM']
tags: ['ImgAgent', 'How do AI images and videos actually work (3Blue1Brown)', 'DDPM']
math: true
toc: true
---

不仅在训练的时候对图像添加噪声，而且在生成的时候也需要在预测后添加一些噪声![V1.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V1.png" | absolute_url }})
对比时候使用DDPM中生成加噪这一操作的图像生成质量
![V2.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V2.png" | absolute_url }})
此外，模型被要求直接预测全部噪声，而非逐步去噪
![V3.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V3.png" | absolute_url }})原因是，从数学上可以证明，预测从随机加噪/扩散100步的点来预测第99步等价于预测到原始点（第0步）的1/100
![V4.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V4.png" | absolute_url }})
这样做还有利于减少训练示例的方差，有利于训练的稳定性
![V5.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V5.png" | absolute_url }})
引入时间步长t作为输入变量，希望模型在t较大的时候学习粗略的扩散方向，而较小的时候学习更为细致的方向
![V6.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V6.png" | absolute_url }})
在文中，强调了在单步去噪后引入一个随机噪声（图中灰色轨迹，蓝色至DDPM在不同时间步t时模型的引导方向），而这个随机噪声会随着步长的减小而减小
![V7.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V7.png" | absolute_url }})
![V8.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V8.png" | absolute_url }})![V9.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V9.png" | absolute_url }})
对256个随机初始化的点（图片像素数16×16，一个点代表一个像素，像素的xy值粗略代表其RGB值）进行扩散，最初是混乱的过程，但最终收敛到目标形状。
我们对这个DDPM的训练数据应该是许多从原始目标形状（螺旋形）添加不同步数噪声的图像，在训练过程中DDPM能得到在不同步长t时应该的引导方向（统计角度？直接学到这步中很多点的平均位置其实就是目标位置？）
![V10.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V10.png" | absolute_url }})如果我们不加入DDPM的随机噪声，初始的随机点会迅速收敛到图案的中心位置而非捕捉完整图像![V11.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V11.png" | absolute_url }})
将螺旋上各个点对应成所有沙漠中树的图像，如果不加入随机噪声，那它会收敛到中心附近的中间值（看起来比较模糊）
![V12.png]({{ "/images/ImgAgent/How do AI images and videos actually work (3Blue1Brown)/DDPM/V12.png" | absolute_url }})
这里现在搞得有些不明白，大致的解释是：模型在正向过程中加入了高斯噪声，目标的分布的均值是μ，模型在反向扩散的时候将会学习到的是预测一个均值为μ的高斯分布。为了使模型预测真正的分布，我们需要在反向的时候加入一个随机的高斯分布（图中灰色向量）来抵消影响？
&nbsp;
存在的问题是计算要求过高，每一步都需要一个强大的神经网络。

